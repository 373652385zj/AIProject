{"remainingRequest":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!/Volumes/JAKY/温博老师给的任务/智能盒子(1)/src/components/Configuration/FaceCheckpointEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/src/components/Configuration/FaceCheckpointEditor.vue","mtime":1606381619000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOw0KaW1wb3J0IHsgdjQgYXMgdXVpZCB9IGZyb20gInV1aWQiOw0KaW1wb3J0IFB1YlN1YiBmcm9tICJwdWJzdWItanMiOw0KaW1wb3J0IGNvbmZpZyBmcm9tICJAL2NvbmZpZy9jb25maWciOw0KaW1wb3J0IGh0dHAgZnJvbSAiQC9jb25maWcvaHR0cCI7DQoNCmNsYXNzIFBhcmtpbmdTcGFjZSB7DQogIGNvbnN0cnVjdG9yKHgsIHksIGlkLCBuYW1lLCBjdHgpIHsNCiAgICB0aGlzLnggPSB4Ow0KICAgIHRoaXMueSA9IHk7DQogICAgdGhpcy5pZCA9IGlkOw0KICAgIHRoaXMuY3R4ID0gY3R4Ow0KICAgIHRoaXMubmFtZSA9IG5hbWU7DQogICAgdGhpcy5yYWRpdXMgPSA1Ow0KICAgIHRoaXMuYXZhaWxhYmxlID0gdHJ1ZTsNCiAgICB0aGlzLmhpZ2hsaWdodCA9IGZhbHNlOw0KICAgIHRoaXMuYXZhaWxhYmxlQ291bnRlciA9IDA7DQogIH0NCg0KICBpc0hvdmVyKG1vdXNlWCwgbW91c2VZKSB7DQogICAgLy8g5rC05bmz6Led56a75oiW5Z6C55u06Led56a75aSn5LqO5Y2K5b6E77yM5YiZ5LiA5a6a5LiN5Y+v6IO95oKs5YGcDQogICAgaWYgKA0KICAgICAgTWF0aC5hYnModGhpcy54IC0gbW91c2VYKSA+IHRoaXMucmFkaXVzIHx8DQogICAgICBNYXRoLmFicyh0aGlzLnkgLSBtb3VzZVkpID4gdGhpcy5yYWRpdXMNCiAgICApIHsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgbGV0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KA0KICAgICAgKHRoaXMueCAtIG1vdXNlWCkgKiAodGhpcy54IC0gbW91c2VYKSArDQogICAgICAgICh0aGlzLnkgLSBtb3VzZVkpICogKHRoaXMueSAtIG1vdXNlWSkNCiAgICApOw0KICAgIGlmIChkaXN0YW5jZSA+IHRoaXMucmFkaXVzKSB7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KICB9DQoNCiAgcmVmcmVzaEF2YWlsYWJpbGl0eShkZXRlY3Rpb25zKSB7DQogICAgbGV0IGF2YWlsYWJsZSA9IHRydWU7DQogICAgbGV0IHN0YXRlQ2hhbmdlZCA9IGZhbHNlOw0KICAgIGZvciAobGV0IGUgb2YgZGV0ZWN0aW9ucykgew0KICAgICAgbGV0IGxlZnQgPSBlWzBdOw0KICAgICAgbGV0IHRvcCA9IGVbMV07DQogICAgICBsZXQgcmlnaHQgPSBsZWZ0ICsgZVsyXTsNCiAgICAgIGxldCBib3R0b20gPSB0b3AgKyBlWzNdOw0KICAgICAgaWYgKHRoaXMueSA+IHRvcCAmJiB0aGlzLnkgPCBib3R0b20gJiYgdGhpcy54ID4gbGVmdCAmJiB0aGlzLnggPCByaWdodCkgew0KICAgICAgICBhdmFpbGFibGUgPSBmYWxzZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICAgIC8v5qih5Z6L5a655piT5oqK5pyJ6L2m6K+G5Yir5oiQ5rKh6L2m77yM5L2G5LiN5a655piT5oqK5rKh6L2m6K+G5Yir5oiQ5pyJ6L2m77yM5omA5Lul6L+e57ut6K+G5Yir5LiJ5qyh5rKh6L2m5omN5pS55Y+Y54q25oCBDQogICAgaWYgKGF2YWlsYWJsZSkgew0KICAgICAgdGhpcy5hdmFpbGFibGVDb3VudGVyKys7DQogICAgICBpZiAodGhpcy5hdmFpbGFibGVDb3VudGVyID09IDMpIHsNCiAgICAgICAgdGhpcy5hdmFpbGFibGUgPSB0cnVlOw0KICAgICAgICB0aGlzLmF2YWlsYWJsZUNvdW50ZXIgPSAwOw0KICAgICAgICBzdGF0ZUNoYW5nZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICBpZiAodGhpcy5hdmFpbGFibGUpIHN0YXRlQ2hhbmdlZCA9IHRydWU7DQogICAgICB0aGlzLmF2YWlsYWJsZSA9IGZhbHNlOw0KICAgICAgdGhpcy5hdmFpbGFibGVDb3VudGVyID0gMDsNCiAgICB9DQogICAgcmV0dXJuIHN0YXRlQ2hhbmdlZDsNCiAgfQ0KDQogIHJlZnJlc2hFeHRlcmlvcihtb3VzZVgsIG1vdXNlWSkgew0KICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOw0KICAgIGxldCBpc0hvdmVyID0gdGhpcy5pc0hvdmVyKG1vdXNlWCwgbW91c2VZKTsNCiAgICBsZXQgcmVzaXplRmFjdG9yID0gdGhpcy5oaWdobGlnaHQgfHwgaXNIb3ZlciA/IDEuNSA6IDE7DQogICAgdGhpcy5jdHguYXJjKA0KICAgICAgdGhpcy54LA0KICAgICAgdGhpcy55LA0KICAgICAgdGhpcy5yYWRpdXMgKiByZXNpemVGYWN0b3IsDQogICAgICAwLA0KICAgICAgMiAqIE1hdGguUEksDQogICAgICBmYWxzZQ0KICAgICk7DQogICAgdGhpcy5jdHguZmlsbFN0eWxlID0gKCgpID0+IHsNCiAgICAgIGlmICh0aGlzLmhpZ2hsaWdodCkgcmV0dXJuICIjZmZhNTAwIjsNCiAgICAgIGlmICh0aGlzLmF2YWlsYWJsZSkgcmV0dXJuICIjMDBmZjAwIjsNCiAgICAgIHJldHVybiAiI2ZmMDAwMCI7DQogICAgfSkoKTsNCiAgICB0aGlzLmN0eC5maWxsKCk7DQogICAgaWYgKGlzSG92ZXIpIHsNCiAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDI7DQogICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IHRoaXMuYXZhaWxhYmxlID8gIiMwMDMzMDAiIDogIiMzMzAwMDAiOw0KICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7DQogICAgfQ0KICB9DQp9DQoNCmNsYXNzIFBhcmtpbmdTcGFjZVN0b3JhZ2Ugew0KICBjb25zdHJ1Y3RvcihjdHgsIGhvc3QpIHsNCiAgICB0aGlzLmN0eCA9IGN0eDsNCiAgICB0aGlzLmhvc3QgPSBob3N0Ow0KICAgIHRoaXMuc3RvcmFnZSA9IG5ldyBNYXAoKTsNCiAgfQ0KDQogIGxvYWQoZGF0YSkgew0KICAgIGZvciAobGV0IGlkIGluIGRhdGEpIHsNCiAgICAgIHRoaXMuY3JlYXRlKGRhdGFbaWRdLngsIGRhdGFbaWRdLnksIGZhbHNlLCBpZCwgZGF0YVtpZF0ubmFtZSk7DQogICAgfQ0KICB9DQoNCiAgY3JlYXRlKHgsIHksIGV4cG9ydE5lZWRlZCwgaWQgPSBudWxsLCBuYW1lID0gbnVsbCkgew0KICAgIGxldCBuZXdJRCA9IGlkID09IG51bGwgPyB1dWlkKCkgOiBpZDsNCiAgICBsZXQgbmV3TmFtZSA9IG5hbWUgPT0gbnVsbCA/IG5ld0lELnN1YnN0cmluZygwLCA1KSA6IG5hbWU7DQogICAgdGhpcy5zdG9yYWdlLnNldCgNCiAgICAgIG5ld0lELA0KICAgICAgbmV3IFBhcmtpbmdTcGFjZShNYXRoLnJvdW5kKHgpLCBNYXRoLnJvdW5kKHkpLCBuZXdJRCwgbmV3TmFtZSwgdGhpcy5jdHgpDQogICAgKTsNCiAgICBQdWJTdWIucHVibGlzaCgiY3JlYXRlIiwgew0KICAgICAgeDogTWF0aC5yb3VuZCh4KSwNCiAgICAgIHk6IE1hdGgucm91bmQoeSksDQogICAgICBpZDogbmV3SUQsDQogICAgICBuYW1lOiBuZXdOYW1lLA0KICAgIH0pOw0KICAgIGlmIChleHBvcnROZWVkZWQpIHRoaXMuZXhwb3J0KCk7DQogICAgcmV0dXJuIG5ld0lEOw0KICB9DQoNCiAgcmVtb3ZlKGVsZW1lbnQpIHsNCiAgICB0aGlzLnN0b3JhZ2UuZGVsZXRlKGVsZW1lbnQuaWQpOw0KICAgIFB1YlN1Yi5wdWJsaXNoKCJyZW1vdmUiLCBlbGVtZW50LmlkKTsNCiAgICB0aGlzLmV4cG9ydCgpOw0KICB9DQoNCiAgZm9yRWFjaChjYWxsYmFjaykgew0KICAgIHRoaXMuc3RvcmFnZS5mb3JFYWNoKGNhbGxiYWNrKTsNCiAgfQ0KDQogIHJlZnJlc2hFeHRlcmlvcihtb3VzZVgsIG1vdXNlWSkgew0KICAgIHRoaXMuZm9yRWFjaCgocHMpID0+IHsNCiAgICAgIHBzLnJlZnJlc2hFeHRlcmlvcihtb3VzZVgsIG1vdXNlWSk7DQogICAgfSk7DQogIH0NCg0KICByZWZyZXNoQXZhaWxhYmlsaXR5KGRldGVjdGlvbnMpIHsNCiAgICB0aGlzLmZvckVhY2goKHBzKSA9PiB7DQogICAgICBsZXQgc3RhdGVDaGFuZ2VkID0gcHMucmVmcmVzaEF2YWlsYWJpbGl0eShkZXRlY3Rpb25zKTsNCiAgICAgIGlmIChzdGF0ZUNoYW5nZWQpIHsNCiAgICAgICAgUHViU3ViLnB1Ymxpc2goImNoYW5nZSIsIHsgaWQ6IHBzLmlkLCBhdmFpbGFibGU6IHBzLmF2YWlsYWJsZSB9KTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KDQogIHJlbmFtZShpZCwgbmFtZSkgew0KICAgIGxldCBlbGVtZW50ID0gdGhpcy5zdG9yYWdlLmdldChpZCk7DQogICAgZWxlbWVudC5uYW1lID0gbmFtZTsNCiAgICB0aGlzLnN0b3JhZ2Uuc2V0KGlkLCBlbGVtZW50KTsNCiAgICB0aGlzLmV4cG9ydCgpOw0KICB9DQoNCiAgaGlnaGxpZ2h0KGlkKSB7DQogICAgdGhpcy5mb3JFYWNoKChwcykgPT4gew0KICAgICAgaWYgKHBzLmlkID09IGlkKSB7DQogICAgICAgIHBzLmhpZ2hsaWdodCA9IHRydWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBwcy5oaWdobGlnaHQgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KDQogIGlzRHVwbGljYXRlKG5hbWUpIHsNCiAgICBsZXQgZHVwbGljYXRlID0gZmFsc2U7DQogICAgdGhpcy5mb3JFYWNoKChwcykgPT4gew0KICAgICAgaWYgKHBzLm5hbWUgPT0gbmFtZSkgZHVwbGljYXRlID0gdHJ1ZTsNCiAgICB9KTsNCiAgICByZXR1cm4gZHVwbGljYXRlOw0KICB9DQoNCiAgZXhwb3J0KCkgew0KICAgIGxldCB0ZW1wU3RvcmFnZSA9IHt9Ow0KICAgIHRoaXMuZm9yRWFjaCgocHMpID0+IHsNCiAgICAgIHRlbXBTdG9yYWdlW3BzLmlkXSA9IHsgeDogcHMueCwgeTogcHMueSwgbmFtZTogcHMubmFtZSB9Ow0KICAgIH0pOw0KICAgIGF4aW9zDQogICAgICAucG9zdCh0aGlzLmhvc3QgKyB0aGlzLmNoZWNrcG9pbnRzVXJsLCB0ZW1wU3RvcmFnZSkNCiAgICAgIC50aGVuKChyZXNwKSA9PiB7DQogICAgICAgIGlmIChyZXNwLmNvZGUgIT09IDIwMCkgew0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoImNhbm5vdCBwb3N0IHBvaW50IGRhdGEiKTsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgICAgIGNvbnNvbGUubG9nKGVycik7DQogICAgICB9KTsNCiAgfQ0KfQ0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJja2Vja3BvaW50LWVkaXRvciIsDQogIG1peGluczogW2h0dHBdLA0KICBkYXRhOiBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIC8v6K+G5Yir57uT5p6c55S75biD5Y+K5YW25LiK5LiL5paHDQogICAgICBkZXRlY3RDYW52YXM6IG51bGwsDQogICAgICBkZXRlY3RDdHg6IG51bGwsDQogICAgICAvL+i9puS9je+8iOajgOafpeeCue+8ieWIl+ihqA0KICAgICAgcGFya2luZ1NwYWNlU3RvcmFnZTogbnVsbCwNCiAgICAgIC8vZGV0ZWN0aW9uID0gW1t4LCB5LCB3LCBoXSwgW3gsIHksIHcsIGhdLCAuLi5dDQogICAgICBkZXRlY3Rpb25zOiBudWxsLA0KICAgICAgLy/pvKDmoIfkvY3nva4NCiAgICAgIG1vdXNlWDogMCwNCiAgICAgIG1vdXNlWTogMCwNCiAgICAgIC8v5piv5ZCm5Zyo57yW6L6R54q25oCBDQogICAgICBlZGl0YWJsZTogZmFsc2UsDQogICAgICAvL+e8lui+keeKtuaAgeebuOWFsw0KICAgICAgZWRpdE1vZGU6ICJpbW1lZGlhdGUiLA0KICAgICAgaW1tZWRpYXRlOiB7DQogICAgICAgIElEOiAiIiwNCiAgICAgICAgbmFtZTogIiIsDQogICAgICAgIHN0YXRlOiBudWxsLA0KICAgICAgfSwNCiAgICAgIGNvbnRpbnVhbHM6IHsNCiAgICAgICAgbmV4dDogIjAwMSIsDQogICAgICAgIHN0YXRlOiBudWxsLA0KICAgICAgfSwNCiAgICAgIC8v5piv5ZCm6L+Y5Zyo5Yid5aeL5YyWDQogICAgICBwcmVwYXJpbmc6IHRydWUsDQogICAgICBob3N0OiBjb25maWcuYXhpb3MuYmFzZVVSTCwNCiAgICAgIHVybDogY29uZmlnLmF4aW9zLnJ0c3BVUkwsDQogICAgICBEV2lkdGg6ICIxMDAlIiwNCiAgICB9Ow0KICB9LA0KICBtZXRob2RzOiB7DQogICAgcmVuYW1lOiBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAodGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmlzRHVwbGljYXRlKHRoaXMuaW1tZWRpYXRlLm5hbWUpKSB7DQogICAgICAgIHRoaXMuaW1tZWRpYXRlLnN0YXRlID0gZmFsc2U7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHRoaXMuaW1tZWRpYXRlLnN0YXRlID0gbnVsbDsNCiAgICAgIFB1YlN1Yi5wdWJsaXNoKCJyZW5hbWUiLCB7DQogICAgICAgIGlkOiB0aGlzLmltbWVkaWF0ZS5JRCwNCiAgICAgICAgbmFtZTogdGhpcy5pbW1lZGlhdGUubmFtZSwNCiAgICAgIH0pOw0KICAgIH0sDQogICAgY29udGludWFsc05leHQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGxldCBkaWdpdCA9IHRoaXMuY29udGludWFscy5uZXh0Lmxlbmd0aDsNCiAgICAgIGxldCBuZXdOZXh0ID0gYCR7TnVtYmVyLnBhcnNlSW50KHRoaXMuY29udGludWFscy5uZXh0KSArIDF9YDsNCiAgICAgIHdoaWxlIChuZXdOZXh0Lmxlbmd0aCA8IGRpZ2l0KSBuZXdOZXh0ID0gYDAke25ld05leHR9YDsNCiAgICAgIHRoaXMuY29udGludWFscy5uZXh0ID0gbmV3TmV4dDsNCiAgICB9LA0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIC8v5Yib5bu65a+56K+G5Yir57uT5p6c55S75biD5Y+K5YW25LiK5LiL5paH55qE5byV55SoDQogICAgLy8gdGhpcy5kZXRlY3RDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0Q2FudmFzIik7DQogICAgLy8gdGhpcy5kZXRlY3RDYW52YXMud2lkdGggPSA3MjA7DQogICAgLy8gdGhpcy5kZXRlY3RDYW52YXMuaGVpZ2h0ID0gNDgwOw0KICAgIC8vIHRoaXMuZGV0ZWN0Q3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRldGVjdENhbnZhcyIpLmdldENvbnRleHQoIjJkIik7DQogICAgLy/liJ3lp4vljJbmo4Dmn6XngrnlgqjlrZgNCiAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UgPSBuZXcgUGFya2luZ1NwYWNlU3RvcmFnZSgNCiAgICAgIHRoaXMuZGV0ZWN0Q3R4LA0KICAgICAgdGhpcy5ob3N0DQogICAgKTsNCiAgICAvL+iOt+WPluacjeWKoeWZqOerr+e8k+WtmOeahOajgOafpeeCueS/oeaBrw0KICAgIHRoaXMuJGN1cmwuZ2V0KHRoaXMuY2hlY2twb2ludHNVcmwpLnRoZW4oKHJlcykgPT4gew0KICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHsNCiAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmxvYWQocmVzLmRhdGEpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kTWVzc2FnZS53YXJuaW5nKEpTT04uc3RyaW5naWZ5KHJlcykpOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIC8vIC8v6I635Y+W6K+G5Yir5qGGDQogICAgLy8gIGF4aW9zDQogICAgLy8gICAgIC5nZXQoYCR7dGhpcy5ob3N0fS9jYW1lcmEvZGV0ZWN0L2JveGApDQogICAgLy8gICAgIC50aGVuKChyZXNwKSA9PiB7DQogICAgLy8gICAgICAgICBpZiAocmVzcC5jb2RlID09IDIwMCkgew0KICAgIC8vICAgICAgICAgICAgIHRoaXMuZGV0ZWN0aW9ucyA9IHJlc3AuZGF0YTsNCiAgICAvLyAgICAgICAgIH0gZWxzZSB7DQogICAgLy8gICAgICAgICAgICAgdGhpcy5kZXRlY3Rpb25zID0gW107DQogICAgLy8gICAgICAgICAgICAgY29uc29sZS5lcnJvcigiY2Fubm90IGZldGNoIGRldGVjdGlvbnMiKTsNCiAgICAvLyAgICAgICAgIH0NCiAgICAvLyAgICAgfSkNCiAgICAvLyAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAgICAvLyAgICAgICAgIGNvbnNvbGUuZXJyb3IoYCR7ZXJyfWApOw0KICAgIC8vICAgICB9KTsNCg0KICAgIC8v5b2T5Zu+5YOP5rqQ5a695bqm5LiN5pivMO+8iOWNs+W3suWKoOi9veWlve+8ieaXtuWPlua2iCLlh4blpIfkuK0i6YGu572pDQogICAgbGV0IHByZXBhcmVDaGVja2VyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXRlY3RTb3VyY2UiKS53aWR0aCAhPSAwKSB7DQogICAgICAgIGNsZWFySW50ZXJ2YWwocHJlcGFyZUNoZWNrZXIpOw0KICAgICAgICB0aGlzLnByZXBhcmluZyA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0sIDUwKTsNCg0KICAgIC8v5q+PNTDmr6vnp5LliLfmlrDkuIDmrKHnlLvluIMNCiAgICBsZXQgbGFzdFJlZnJlc2hUaW1lc3RhbXAgPSAwOw0KICAgIGxldCByZWZyZXNoQ2FudmFzID0gKHRpbWUpID0+IHsNCiAgICAgIGlmICh0aW1lIC0gbGFzdFJlZnJlc2hUaW1lc3RhbXAgPiA1MCkgew0KICAgICAgICBsYXN0UmVmcmVzaFRpbWVzdGFtcCA9IHRpbWU7DQogICAgICAgIGxldCBzb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0U291cmNlIik7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgdGhpcy5kZXRlY3RDdHguZHJhd0ltYWdlKHNvdXJjZSwgMCwgMCk7DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgLyppZ25vcmUgd2FybmluZyovDQogICAgICAgIH0NCiAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLnJlZnJlc2hFeHRlcmlvcih0aGlzLm1vdXNlWCwgdGhpcy5tb3VzZVkpOw0KICAgICAgfQ0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlZnJlc2hDYW52YXMpOw0KICAgIH07DQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlZnJlc2hDYW52YXMpOw0KDQogICAgLy/mr48056eS6I635Y+W5LiA5qyh6K+G5Yir5qGG5bm25Yi35paw5Y2g55So5oOF5Ya1DQogICAgbGV0IGxhc3RGZXRjaFRpbWVzdGFtcCA9IDA7DQogICAgLy8gbGV0IGZldGNoRGV0ZWN0aW9uID0gYXN5bmMgKHRpbWUpID0+IHsNCiAgICAvLyAgICAgaWYgKHRpbWUgLSBsYXN0RmV0Y2hUaW1lc3RhbXAgPiA0MDAwKSB7DQogICAgLy8gICAgICAgICBsYXN0RmV0Y2hUaW1lc3RhbXAgPSB0aW1lOw0KICAgIC8vICAgICAgICAgYXdhaXQgYXhpb3MNCiAgICAvLyAgICAgICAgICAgICAuZ2V0KGAke3RoaXMuaG9zdH0vY2FtZXJhL2RldGVjdC9ib3hgKQ0KICAgIC8vICAgICAgICAgICAgIC50aGVuKChyZXNwKSA9PiB7DQogICAgLy8gICAgICAgICAgICAgICAgIGlmIChyZXNwLmNvZGUgPT0gMjAwKSB7DQogICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLmRldGVjdGlvbnMgPSByZXNwLmRhdGE7DQogICAgLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLmRldGVjdGlvbnMgPSBbXTsNCiAgICAvLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoImNhbm5vdCBmZXRjaCBkZXRlY3Rpb25zIik7DQogICAgLy8gICAgICAgICAgICAgICAgIH0NCiAgICAvLyAgICAgICAgICAgICB9KQ0KICAgIC8vICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7DQogICAgLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICAvLyAgICAgICAgICAgICB9KTsNCiAgICAvLyAgICAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5yZWZyZXNoQXZhaWxhYmlsaXR5KHRoaXMuZGV0ZWN0aW9ucyk7DQogICAgLy8gICAgIH0NCiAgICAvLyAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZldGNoRGV0ZWN0aW9uKTsNCiAgICAvLyB9DQogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZldGNoRGV0ZWN0aW9uKTsNCg0KICAgIC8v5Y+W5raI55S75biD54K55Ye75Y+z6ZSu5pe25by55Ye65Y+z6ZSu6I+c5Y2VDQogICAgdGhpcy5kZXRlY3RDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigiY29udGV4dG1lbnUiLCAoZXZlbnQpID0+IHsNCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgfSk7DQoNCiAgICAvL+m8oOagh+aKrOi1t+aXtuWwneivleWIm+W7uuaWsOajgOafpeeCuQ0KICAgIHRoaXMuZGV0ZWN0Q2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCAoZXZlbnQpID0+IHsNCiAgICAgIGlmICghdGhpcy5lZGl0YWJsZSkgcmV0dXJuOw0KICAgICAgaWYgKHRoaXMubW91c2VYIDwgNzIwICYmIHRoaXMubW91c2VZIDwgNDgwKSB7DQogICAgICAgIGxldCBuZXdQYXJraW5nU3BhY2UgPSB0cnVlOw0KICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09IDApIHsNCiAgICAgICAgICAvL+W3pumUruWNleWHu+aXtg0KICAgICAgICAgIC8v5aaC5p6c5rKh5pyJ5oKs5YGc5Zyo546w5pyJ5qOA5p+l54K55LiK77yM5YiZ5Yib5bu65LiA5Liq5paw55qE5qOA5p+l54K5DQogICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmZvckVhY2goKHBzKSA9PiB7DQogICAgICAgICAgICBpZiAocHMuaXNIb3Zlcih0aGlzLm1vdXNlWCwgdGhpcy5tb3VzZVkpKSB7DQogICAgICAgICAgICAgIG5ld1BhcmtpbmdTcGFjZSA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGlmIChuZXdQYXJraW5nU3BhY2UpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmVkaXRNb2RlID09ICJpbW1lZGlhdGUiKSB7DQogICAgICAgICAgICAgIHRoaXMuaW1tZWRpYXRlLklEID0gdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmNyZWF0ZSgNCiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWCwNCiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWSwNCiAgICAgICAgICAgICAgICB0cnVlDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgIHRoaXMuJHJlZnNbImltbWVkaWF0ZS1pbnB1dCJdLmZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5lZGl0TW9kZSA9PSAiY29udGludWFscyIpIHsNCiAgICAgICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmNyZWF0ZSgNCiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWCwNCiAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWSwNCiAgICAgICAgICAgICAgICB0cnVlLA0KICAgICAgICAgICAgICAgIG51bGwsDQogICAgICAgICAgICAgICAgdGhpcy5jb250aW51YWxzLm5leHQNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgdGhpcy5jb250aW51YWxzTmV4dCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIGlmIChldmVudC5idXR0b24gPT0gMikgew0KICAgICAgICAgIC8v5Y+z6ZSu5Y2V5Ye75pe2DQogICAgICAgICAgLy/lpoLmnpzmgqzlgZzlnKjnjrDmnInmo4Dmn6XngrnkuIrvvIzliJnliKDpmaTov5nkuKrmo4Dmn6XngrkNCiAgICAgICAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UuZm9yRWFjaCgocHMpID0+IHsNCiAgICAgICAgICAgIGlmIChwcy5pc0hvdmVyKHRoaXMubW91c2VYLCB0aGlzLm1vdXNlWSkpIHsNCiAgICAgICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLnJlbW92ZShwcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuYnV0dG9uID09IDEpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZyhgKCR7dGhpcy5tb3VzZVh9LCAke3RoaXMubW91c2VZfSlgKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy/pvKDmoIfnp7vliqjml7bliLfmlrDlgqjlrZjnmoTpvKDmoIfkvY3nva4NCiAgICB0aGlzLmRldGVjdENhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCAoZXZlbnQpID0+IHsNCiAgICAgIGlmICghdGhpcy5lZGl0YWJsZSkgcmV0dXJuOw0KICAgICAgbGV0IHJlY3QgPSB0aGlzLmRldGVjdENhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgIGxldCBzY2FsZSA9IDcyMCAvIHJlY3Qud2lkdGg7DQogICAgICB0aGlzLm1vdXNlWCA9IChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KSAqIHNjYWxlOw0KICAgICAgdGhpcy5tb3VzZVkgPSAoZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKSAqIHNjYWxlOw0KICAgIH0pOw0KDQogICAgdGhpcy5kZXRlY3RDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgKCkgPT4gew0KICAgICAgaWYgKHRoaXMuZWRpdE1vZGUgPT0gImltbWVkaWF0ZSIpIHsNCiAgICAgICAgdGhpcy5pbW1lZGlhdGUuSUQgPSAiIjsNCiAgICAgICAgdGhpcy5pbW1lZGlhdGUubmFtZSA9ICIiOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy/kuovku7blpITnkIYNCiAgICBQdWJTdWIuc3Vic2NyaWJlKCJyZW5hbWUiLCAobXNnLCBwYXlsb2FkKSA9PiB7DQogICAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UucmVuYW1lKHBheWxvYWQuaWQsIHBheWxvYWQubmFtZSk7DQogICAgfSk7DQogICAgUHViU3ViLnN1YnNjcmliZSgiaGlnaGxpZ2h0IiwgKG1zZywgaWQpID0+IHsNCiAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5oaWdobGlnaHQoaWQpOw0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogUHJvdmlkZXMgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGluIGEgY3Jvc3MgYnJvd3NlciB3YXkuDQogICAgICogaHR0cDovL3BhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy8NCiAgICAgKi8NCiAgICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsNCiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gKA0KICAgICAgICAgIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCiAgICAgICAgICB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8DQogICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCiAgICAgICAgICB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCiAgICAgICAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHsNCiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApOw0KICAgICAgICAgIH0NCiAgICAgICAgKTsNCiAgICAgIH0pKCk7DQogICAgfQ0KICB9LA0KICBtb3VudGVkKCkgew0KICAgICAgLy8g6K6+572u56qX5Y+j5Y+Y5YyW5pS55Y+Y6KeG6aKR5aSn5bCPDQogICAgdmFyIF90aGlzID0gdGhpczsNCiAgICB3aW5kb3cub25yZXNpemUgPSAoKSA9PiB7DQogICAgICByZXR1cm4gKCgpID0+IHsNCiAgICAgICAgdmFyIHcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0U291cmNlIikud2lkdGg7DQogICAgICAgIHZhciBoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRldGVjdFNvdXJjZSIpLmhlaWdodDsNCiAgICAgICAgdmFyIGQgPSB3IC8gNzIwOw0KICAgICAgICBfdGhpcy5ESGVpZ2h0ID0gNDgwICogZDsNCiAgICAgIH0pKCk7DQogICAgfTsNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBlZGl0YWJsZShuZXdWYWwpIHsNCiAgICAgIGlmIChuZXdWYWwpIFB1YlN1Yi5wdWJsaXNoKCJlZGl0LXN0YXJ0Iik7DQogICAgICBlbHNlIFB1YlN1Yi5wdWJsaXNoKCJlZGl0LWVuZCIpOw0KICAgIH0sDQogIH0sDQp9Ow0K"},{"version":3,"sources":["FaceCheckpointEditor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FaceCheckpointEditor.vue","sourceRoot":"src/components/Configuration","sourcesContent":["<template>\r\n  <b-card fluid>\r\n    <template v-slot:header>\r\n      识别结果\r\n      <!--            <b-button class=\"float-right\" size=\"sm\" variant=\"outline-secondary\" v-b-modal.live>实时画面</b-button>-->\r\n      <b-modal id=\"live\" title=\"实时画面\" size=\"lg\" ok-only ok-title=\"返回\">\r\n        <b-img :src=\"host + '/camera/live'\" fluid-grow />\r\n      </b-modal>\r\n    </template>\r\n    <!-- 基于mjpeg流的识别结果图像 -->\r\n    <img\r\n      :src=\"host + getFaceBoxLiveUrl + '?url=' + url\"\r\n      id=\"detectSource\"\r\n      crossorigin=\"Anonymous\"\r\n      :width=\"DWidth\"\r\n      :height=\"DHeight\"\r\n    />\r\n    <!-- UI设计时占位用的猫猫图 -->\r\n    <!--         <img src=\"../../assets/720x480.png\" id=\"detectSource\" style=\"display: none;\" />-->\r\n    <!-- 主画布 -->\r\n    <!--                <b-overlay :show=\"preparing\">-->\r\n    <!--                    <canvas id=\"detectCanvas\"></canvas>-->\r\n    <!--                </b-overlay>-->\r\n    <!-- 编辑模式的控制表单 -->\r\n    <div v-if=\"editable\">\r\n      <!-- 编辑模式选择器 -->\r\n      <b-form-radio-group id=\"editModeSelector\" v-model=\"editMode\" class=\"mb-3\">\r\n        <b-form-radio value=\"immediate\">即时编号模式</b-form-radio>\r\n        <b-form-radio value=\"continuals\">连续编号模式</b-form-radio>\r\n      </b-form-radio-group>\r\n      <!-- 即时编号模式：每创建一个点，输入框就获得焦点 -->\r\n      <b-form inline v-if=\"editMode == 'immediate'\" class=\"mb-3\">\r\n        <label for=\"immediate-input\">输入编号</label>\r\n        <b-form-input\r\n          id=\"immediate-input\"\r\n          ref=\"immediate-input\"\r\n          v-model=\"immediate.name\"\r\n          :state=\"immediate.state\"\r\n          @keyup=\"rename\"\r\n        />\r\n      </b-form>\r\n      <!-- 连续编号模式：输入初始值，按顺序递增 -->\r\n      <b-form inline v-if=\"editMode == 'continuals'\" class=\"mb-3\">\r\n        <label for=\"continuals-input\">下一个编号</label>\r\n        <b-form-input\r\n          id=\"continuals-input\"\r\n          v-model=\"continuals.next\"\r\n          :state=\"continuals.state\"\r\n        />\r\n      </b-form>\r\n    </div>\r\n    <!-- 切换编辑模式的按钮 -->\r\n    <b-button\r\n      block\r\n      class=\"mt-3\"\r\n      variant=\"outline-secondary\"\r\n      @click=\"editable = !editable\"\r\n    >\r\n      {{ editable ? \"完成\" : \"编辑\" }}\r\n    </b-button>\r\n  </b-card>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport PubSub from \"pubsub-js\";\r\nimport config from \"@/config/config\";\r\nimport http from \"@/config/http\";\r\n\r\nclass ParkingSpace {\r\n  constructor(x, y, id, name, ctx) {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.id = id;\r\n    this.ctx = ctx;\r\n    this.name = name;\r\n    this.radius = 5;\r\n    this.available = true;\r\n    this.highlight = false;\r\n    this.availableCounter = 0;\r\n  }\r\n\r\n  isHover(mouseX, mouseY) {\r\n    // 水平距离或垂直距离大于半径，则一定不可能悬停\r\n    if (\r\n      Math.abs(this.x - mouseX) > this.radius ||\r\n      Math.abs(this.y - mouseY) > this.radius\r\n    ) {\r\n      return false;\r\n    }\r\n    let distance = Math.sqrt(\r\n      (this.x - mouseX) * (this.x - mouseX) +\r\n        (this.y - mouseY) * (this.y - mouseY)\r\n    );\r\n    if (distance > this.radius) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  refreshAvailability(detections) {\r\n    let available = true;\r\n    let stateChanged = false;\r\n    for (let e of detections) {\r\n      let left = e[0];\r\n      let top = e[1];\r\n      let right = left + e[2];\r\n      let bottom = top + e[3];\r\n      if (this.y > top && this.y < bottom && this.x > left && this.x < right) {\r\n        available = false;\r\n        break;\r\n      }\r\n    }\r\n    //模型容易把有车识别成没车，但不容易把没车识别成有车，所以连续识别三次没车才改变状态\r\n    if (available) {\r\n      this.availableCounter++;\r\n      if (this.availableCounter == 3) {\r\n        this.available = true;\r\n        this.availableCounter = 0;\r\n        stateChanged = true;\r\n      }\r\n    } else {\r\n      if (this.available) stateChanged = true;\r\n      this.available = false;\r\n      this.availableCounter = 0;\r\n    }\r\n    return stateChanged;\r\n  }\r\n\r\n  refreshExterior(mouseX, mouseY) {\r\n    this.ctx.beginPath();\r\n    let isHover = this.isHover(mouseX, mouseY);\r\n    let resizeFactor = this.highlight || isHover ? 1.5 : 1;\r\n    this.ctx.arc(\r\n      this.x,\r\n      this.y,\r\n      this.radius * resizeFactor,\r\n      0,\r\n      2 * Math.PI,\r\n      false\r\n    );\r\n    this.ctx.fillStyle = (() => {\r\n      if (this.highlight) return \"#ffa500\";\r\n      if (this.available) return \"#00ff00\";\r\n      return \"#ff0000\";\r\n    })();\r\n    this.ctx.fill();\r\n    if (isHover) {\r\n      this.ctx.lineWidth = 2;\r\n      this.ctx.strokeStyle = this.available ? \"#003300\" : \"#330000\";\r\n      this.ctx.stroke();\r\n    }\r\n  }\r\n}\r\n\r\nclass ParkingSpaceStorage {\r\n  constructor(ctx, host) {\r\n    this.ctx = ctx;\r\n    this.host = host;\r\n    this.storage = new Map();\r\n  }\r\n\r\n  load(data) {\r\n    for (let id in data) {\r\n      this.create(data[id].x, data[id].y, false, id, data[id].name);\r\n    }\r\n  }\r\n\r\n  create(x, y, exportNeeded, id = null, name = null) {\r\n    let newID = id == null ? uuid() : id;\r\n    let newName = name == null ? newID.substring(0, 5) : name;\r\n    this.storage.set(\r\n      newID,\r\n      new ParkingSpace(Math.round(x), Math.round(y), newID, newName, this.ctx)\r\n    );\r\n    PubSub.publish(\"create\", {\r\n      x: Math.round(x),\r\n      y: Math.round(y),\r\n      id: newID,\r\n      name: newName,\r\n    });\r\n    if (exportNeeded) this.export();\r\n    return newID;\r\n  }\r\n\r\n  remove(element) {\r\n    this.storage.delete(element.id);\r\n    PubSub.publish(\"remove\", element.id);\r\n    this.export();\r\n  }\r\n\r\n  forEach(callback) {\r\n    this.storage.forEach(callback);\r\n  }\r\n\r\n  refreshExterior(mouseX, mouseY) {\r\n    this.forEach((ps) => {\r\n      ps.refreshExterior(mouseX, mouseY);\r\n    });\r\n  }\r\n\r\n  refreshAvailability(detections) {\r\n    this.forEach((ps) => {\r\n      let stateChanged = ps.refreshAvailability(detections);\r\n      if (stateChanged) {\r\n        PubSub.publish(\"change\", { id: ps.id, available: ps.available });\r\n      }\r\n    });\r\n  }\r\n\r\n  rename(id, name) {\r\n    let element = this.storage.get(id);\r\n    element.name = name;\r\n    this.storage.set(id, element);\r\n    this.export();\r\n  }\r\n\r\n  highlight(id) {\r\n    this.forEach((ps) => {\r\n      if (ps.id == id) {\r\n        ps.highlight = true;\r\n      } else {\r\n        ps.highlight = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  isDuplicate(name) {\r\n    let duplicate = false;\r\n    this.forEach((ps) => {\r\n      if (ps.name == name) duplicate = true;\r\n    });\r\n    return duplicate;\r\n  }\r\n\r\n  export() {\r\n    let tempStorage = {};\r\n    this.forEach((ps) => {\r\n      tempStorage[ps.id] = { x: ps.x, y: ps.y, name: ps.name };\r\n    });\r\n    axios\r\n      .post(this.host + this.checkpointsUrl, tempStorage)\r\n      .then((resp) => {\r\n        if (resp.code !== 200) {\r\n          console.error(\"cannot post point data\");\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n}\r\n\r\nexport default {\r\n  name: \"ckeckpoint-editor\",\r\n  mixins: [http],\r\n  data: function () {\r\n    return {\r\n      //识别结果画布及其上下文\r\n      detectCanvas: null,\r\n      detectCtx: null,\r\n      //车位（检查点）列表\r\n      parkingSpaceStorage: null,\r\n      //detection = [[x, y, w, h], [x, y, w, h], ...]\r\n      detections: null,\r\n      //鼠标位置\r\n      mouseX: 0,\r\n      mouseY: 0,\r\n      //是否在编辑状态\r\n      editable: false,\r\n      //编辑状态相关\r\n      editMode: \"immediate\",\r\n      immediate: {\r\n        ID: \"\",\r\n        name: \"\",\r\n        state: null,\r\n      },\r\n      continuals: {\r\n        next: \"001\",\r\n        state: null,\r\n      },\r\n      //是否还在初始化\r\n      preparing: true,\r\n      host: config.axios.baseURL,\r\n      url: config.axios.rtspURL,\r\n      DWidth: \"100%\",\r\n    };\r\n  },\r\n  methods: {\r\n    rename: function () {\r\n      if (this.parkingSpaceStorage.isDuplicate(this.immediate.name)) {\r\n        this.immediate.state = false;\r\n        return;\r\n      }\r\n      this.immediate.state = null;\r\n      PubSub.publish(\"rename\", {\r\n        id: this.immediate.ID,\r\n        name: this.immediate.name,\r\n      });\r\n    },\r\n    continualsNext: function () {\r\n      let digit = this.continuals.next.length;\r\n      let newNext = `${Number.parseInt(this.continuals.next) + 1}`;\r\n      while (newNext.length < digit) newNext = `0${newNext}`;\r\n      this.continuals.next = newNext;\r\n    },\r\n  },\r\n  created() {\r\n    //创建对识别结果画布及其上下文的引用\r\n    // this.detectCanvas = document.getElementById(\"detectCanvas\");\r\n    // this.detectCanvas.width = 720;\r\n    // this.detectCanvas.height = 480;\r\n    // this.detectCtx = document.getElementById(\"detectCanvas\").getContext(\"2d\");\r\n    //初始化检查点储存\r\n    this.parkingSpaceStorage = new ParkingSpaceStorage(\r\n      this.detectCtx,\r\n      this.host\r\n    );\r\n    //获取服务器端缓存的检查点信息\r\n    this.$curl.get(this.checkpointsUrl).then((res) => {\r\n      if (res.code === 200) {\r\n        this.parkingSpaceStorage.load(res.data);\r\n      } else {\r\n        this.$Message.warning(JSON.stringify(res));\r\n      }\r\n    });\r\n    // //获取识别框\r\n    //  axios\r\n    //     .get(`${this.host}/camera/detect/box`)\r\n    //     .then((resp) => {\r\n    //         if (resp.code == 200) {\r\n    //             this.detections = resp.data;\r\n    //         } else {\r\n    //             this.detections = [];\r\n    //             console.error(\"cannot fetch detections\");\r\n    //         }\r\n    //     })\r\n    //     .catch((err) => {\r\n    //         console.error(`${err}`);\r\n    //     });\r\n\r\n    //当图像源宽度不是0（即已加载好）时取消\"准备中\"遮罩\r\n    let prepareChecker = setInterval(() => {\r\n      if (document.getElementById(\"detectSource\").width != 0) {\r\n        clearInterval(prepareChecker);\r\n        this.preparing = false;\r\n      }\r\n    }, 50);\r\n\r\n    //每50毫秒刷新一次画布\r\n    let lastRefreshTimestamp = 0;\r\n    let refreshCanvas = (time) => {\r\n      if (time - lastRefreshTimestamp > 50) {\r\n        lastRefreshTimestamp = time;\r\n        let source = document.getElementById(\"detectSource\");\r\n        try {\r\n          this.detectCtx.drawImage(source, 0, 0);\r\n        } catch (error) {\r\n          /*ignore warning*/\r\n        }\r\n        this.parkingSpaceStorage.refreshExterior(this.mouseX, this.mouseY);\r\n      }\r\n      requestAnimationFrame(refreshCanvas);\r\n    };\r\n    requestAnimationFrame(refreshCanvas);\r\n\r\n    //每4秒获取一次识别框并刷新占用情况\r\n    let lastFetchTimestamp = 0;\r\n    // let fetchDetection = async (time) => {\r\n    //     if (time - lastFetchTimestamp > 4000) {\r\n    //         lastFetchTimestamp = time;\r\n    //         await axios\r\n    //             .get(`${this.host}/camera/detect/box`)\r\n    //             .then((resp) => {\r\n    //                 if (resp.code == 200) {\r\n    //                     this.detections = resp.data;\r\n    //                 } else {\r\n    //                     this.detections = [];\r\n    //                     console.error(\"cannot fetch detections\");\r\n    //                 }\r\n    //             })\r\n    //             .catch((err) => {\r\n    //                 console.error(err);\r\n    //             });\r\n    //         this.parkingSpaceStorage.refreshAvailability(this.detections);\r\n    //     }\r\n    //     requestAnimationFrame(fetchDetection);\r\n    // }\r\n    requestAnimationFrame(fetchDetection);\r\n\r\n    //取消画布点击右键时弹出右键菜单\r\n    this.detectCanvas.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    //鼠标抬起时尝试创建新检查点\r\n    this.detectCanvas.addEventListener(\"mouseup\", (event) => {\r\n      if (!this.editable) return;\r\n      if (this.mouseX < 720 && this.mouseY < 480) {\r\n        let newParkingSpace = true;\r\n        if (event.button == 0) {\r\n          //左键单击时\r\n          //如果没有悬停在现有检查点上，则创建一个新的检查点\r\n          this.parkingSpaceStorage.forEach((ps) => {\r\n            if (ps.isHover(this.mouseX, this.mouseY)) {\r\n              newParkingSpace = false;\r\n            }\r\n          });\r\n          if (newParkingSpace) {\r\n            if (this.editMode == \"immediate\") {\r\n              this.immediate.ID = this.parkingSpaceStorage.create(\r\n                this.mouseX,\r\n                this.mouseY,\r\n                true\r\n              );\r\n              this.$refs[\"immediate-input\"].focus();\r\n            }\r\n            if (this.editMode == \"continuals\") {\r\n              this.parkingSpaceStorage.create(\r\n                this.mouseX,\r\n                this.mouseY,\r\n                true,\r\n                null,\r\n                this.continuals.next\r\n              );\r\n              this.continualsNext();\r\n            }\r\n          }\r\n        } else if (event.button == 2) {\r\n          //右键单击时\r\n          //如果悬停在现有检查点上，则删除这个检查点\r\n          this.parkingSpaceStorage.forEach((ps) => {\r\n            if (ps.isHover(this.mouseX, this.mouseY)) {\r\n              this.parkingSpaceStorage.remove(ps);\r\n            }\r\n          });\r\n        } else if (event.button == 1) {\r\n          console.log(`(${this.mouseX}, ${this.mouseY})`);\r\n        }\r\n      }\r\n    });\r\n\r\n    //鼠标移动时刷新储存的鼠标位置\r\n    this.detectCanvas.addEventListener(\"mousemove\", (event) => {\r\n      if (!this.editable) return;\r\n      let rect = this.detectCanvas.getBoundingClientRect();\r\n      let scale = 720 / rect.width;\r\n      this.mouseX = (event.clientX - rect.left) * scale;\r\n      this.mouseY = (event.clientY - rect.top) * scale;\r\n    });\r\n\r\n    this.detectCanvas.addEventListener(\"mousedown\", () => {\r\n      if (this.editMode == \"immediate\") {\r\n        this.immediate.ID = \"\";\r\n        this.immediate.name = \"\";\r\n      }\r\n    });\r\n\r\n    //事件处理\r\n    PubSub.subscribe(\"rename\", (msg, payload) => {\r\n      this.parkingSpaceStorage.rename(payload.id, payload.name);\r\n    });\r\n    PubSub.subscribe(\"highlight\", (msg, id) => {\r\n      this.parkingSpaceStorage.highlight(id);\r\n    });\r\n\r\n    /**\r\n     * Provides requestAnimationFrame in a cross browser way.\r\n     * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n     */\r\n    if (!window.requestAnimationFrame) {\r\n      window.requestAnimationFrame = (function () {\r\n        return (\r\n          window.webkitRequestAnimationFrame ||\r\n          window.mozRequestAnimationFrame ||\r\n          window.oRequestAnimationFrame ||\r\n          window.msRequestAnimationFrame ||\r\n          function (callback) {\r\n            window.setTimeout(callback, 1000 / 60);\r\n          }\r\n        );\r\n      })();\r\n    }\r\n  },\r\n  mounted() {\r\n      // 设置窗口变化改变视频大小\r\n    var _this = this;\r\n    window.onresize = () => {\r\n      return (() => {\r\n        var w = document.getElementById(\"detectSource\").width;\r\n        var h = document.getElementById(\"detectSource\").height;\r\n        var d = w / 720;\r\n        _this.DHeight = 480 * d;\r\n      })();\r\n    };\r\n  },\r\n  watch: {\r\n    editable(newVal) {\r\n      if (newVal) PubSub.publish(\"edit-start\");\r\n      else PubSub.publish(\"edit-end\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n#detectCanvas {\r\n  width: 100%;\r\n}\r\n</style>\r\n"]}]}