{"remainingRequest":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!/Volumes/JAKY/温博老师给的任务/智能盒子(1)/src/components/Configuration/CheckpointEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/src/components/Configuration/CheckpointEditor.vue","mtime":1601024882000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Volumes/JAKY/温博老师给的任务/智能盒子(1)/node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCB7djQgYXMgdXVpZH0gZnJvbSAidXVpZCI7CmltcG9ydCBQdWJTdWIgZnJvbSAicHVic3ViLWpzIjsKaW1wb3J0IGNvbmZpZyBmcm9tICJAL2NvbmZpZy9jb25maWciOwoKY2xhc3MgUGFya2luZ1NwYWNlIHsKICAgIGNvbnN0cnVjdG9yKHgsIHksIGlkLCBuYW1lLCBjdHgpIHsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5yYWRpdXMgPSA1OwogICAgICAgIHRoaXMuYXZhaWxhYmxlID0gdHJ1ZTsKICAgICAgICB0aGlzLmhpZ2hsaWdodCA9IGZhbHNlOwogICAgICAgIHRoaXMuYXZhaWxhYmxlQ291bnRlciA9IDA7CiAgICB9CgogICAgaXNIb3Zlcihtb3VzZVgsIG1vdXNlWSkgewogICAgICAgIC8vIOawtOW5s+i3neemu+aIluWeguebtOi3neemu+Wkp+S6juWNiuW+hO+8jOWImeS4gOWumuS4jeWPr+iDveaCrOWBnAogICAgICAgIGlmICgKICAgICAgICAgICAgTWF0aC5hYnModGhpcy54IC0gbW91c2VYKSA+IHRoaXMucmFkaXVzIHx8CiAgICAgICAgICAgIE1hdGguYWJzKHRoaXMueSAtIG1vdXNlWSkgPiB0aGlzLnJhZGl1cwogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGxldCBkaXN0YW5jZSA9IE1hdGguc3FydCgKICAgICAgICAgICAgKHRoaXMueCAtIG1vdXNlWCkgKiAodGhpcy54IC0gbW91c2VYKSArCiAgICAgICAgICAgICh0aGlzLnkgLSBtb3VzZVkpICogKHRoaXMueSAtIG1vdXNlWSkKICAgICAgICApOwogICAgICAgIGlmIChkaXN0YW5jZSA+IHRoaXMucmFkaXVzKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmVmcmVzaEF2YWlsYWJpbGl0eShkZXRlY3Rpb25zKSB7CiAgICAgICAgbGV0IGF2YWlsYWJsZSA9IHRydWU7CiAgICAgICAgbGV0IHN0YXRlQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgIGZvciAobGV0IGUgb2YgZGV0ZWN0aW9ucykgewogICAgICAgICAgICBsZXQgbGVmdCA9IGVbMF07CiAgICAgICAgICAgIGxldCB0b3AgPSBlWzFdOwogICAgICAgICAgICBsZXQgcmlnaHQgPSBsZWZ0ICsgZVsyXTsKICAgICAgICAgICAgbGV0IGJvdHRvbSA9IHRvcCArIGVbM107CiAgICAgICAgICAgIGlmICh0aGlzLnkgPiB0b3AgJiYgdGhpcy55IDwgYm90dG9tICYmIHRoaXMueCA+IGxlZnQgJiYgdGhpcy54IDwgcmlnaHQpIHsKICAgICAgICAgICAgICAgIGF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy/mqKHlnovlrrnmmJPmiormnInovabor4bliKvmiJDmsqHovabvvIzkvYbkuI3lrrnmmJPmiormsqHovabor4bliKvmiJDmnInovabvvIzmiYDku6Xov57nu63or4bliKvkuInmrKHmsqHovabmiY3mlLnlj5jnirbmgIEKICAgICAgICBpZiAoYXZhaWxhYmxlKSB7CiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlQ291bnRlcisrOwogICAgICAgICAgICBpZiAodGhpcy5hdmFpbGFibGVDb3VudGVyID09IDMpIHsKICAgICAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlQ291bnRlciA9IDA7CiAgICAgICAgICAgICAgICBzdGF0ZUNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuYXZhaWxhYmxlKSBzdGF0ZUNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmF2YWlsYWJsZUNvdW50ZXIgPSAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RhdGVDaGFuZ2VkOwogICAgfQoKICAgIHJlZnJlc2hFeHRlcmlvcihtb3VzZVgsIG1vdXNlWSkgewogICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGxldCBpc0hvdmVyID0gdGhpcy5pc0hvdmVyKG1vdXNlWCwgbW91c2VZKQogICAgICAgIGxldCByZXNpemVGYWN0b3IgPSAodGhpcy5oaWdobGlnaHQgfHwgaXNIb3ZlcikgPyAxLjUgOiAxCiAgICAgICAgdGhpcy5jdHguYXJjKHRoaXMueCwgdGhpcy55LCB0aGlzLnJhZGl1cyAqIHJlc2l6ZUZhY3RvciwgMCwgMiAqIE1hdGguUEksIGZhbHNlKTsKICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSAoKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5oaWdobGlnaHQpIHJldHVybiAiI2ZmYTUwMCI7CiAgICAgICAgICAgIGlmICh0aGlzLmF2YWlsYWJsZSkgcmV0dXJuICIjMDBmZjAwIjsKICAgICAgICAgICAgcmV0dXJuICIjZmYwMDAwIjsKICAgICAgICB9KSgpOwogICAgICAgIHRoaXMuY3R4LmZpbGwoKTsKICAgICAgICBpZiAoaXNIb3ZlcikgewogICAgICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSAyOwogICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IHRoaXMuYXZhaWxhYmxlID8gIiMwMDMzMDAiIDogIiMzMzAwMDAiOwogICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTsKICAgICAgICB9CiAgICB9Cn0KCmNsYXNzIFBhcmtpbmdTcGFjZVN0b3JhZ2UgewogICAgY29uc3RydWN0b3IoY3R4LCBob3N0KSB7CiAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgdGhpcy5ob3N0ID0gaG9zdDsKICAgICAgICB0aGlzLnN0b3JhZ2UgPSBuZXcgTWFwKCk7CiAgICB9CgogICAgbG9hZChkYXRhKSB7CiAgICAgICAgZm9yIChsZXQgaWQgaW4gZGF0YSkgewogICAgICAgICAgICB0aGlzLmNyZWF0ZShkYXRhW2lkXS54LCBkYXRhW2lkXS55LCBmYWxzZSwgaWQsIGRhdGFbaWRdLm5hbWUpOwogICAgICAgIH0KICAgIH0KCiAgICBjcmVhdGUoeCwgeSwgZXhwb3J0TmVlZGVkLCBpZCA9IG51bGwsIG5hbWUgPSBudWxsKSB7CiAgICAgICAgbGV0IG5ld0lEID0gaWQgPT0gbnVsbCA/IHV1aWQoKSA6IGlkOwogICAgICAgIGxldCBuZXdOYW1lID0gbmFtZSA9PSBudWxsID8gbmV3SUQuc3Vic3RyaW5nKDAsIDUpIDogbmFtZTsKICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0KAogICAgICAgICAgICBuZXdJRCwKICAgICAgICAgICAgbmV3IFBhcmtpbmdTcGFjZShNYXRoLnJvdW5kKHgpLCBNYXRoLnJvdW5kKHkpLCBuZXdJRCwgbmV3TmFtZSwgdGhpcy5jdHgpCiAgICAgICAgKTsKICAgICAgICBQdWJTdWIucHVibGlzaCgiY3JlYXRlIiwgewogICAgICAgICAgICB4OiBNYXRoLnJvdW5kKHgpLAogICAgICAgICAgICB5OiBNYXRoLnJvdW5kKHkpLAogICAgICAgICAgICBpZDogbmV3SUQsCiAgICAgICAgICAgIG5hbWU6IG5ld05hbWUsCiAgICAgICAgfSk7CiAgICAgICAgaWYgKGV4cG9ydE5lZWRlZCkgdGhpcy5leHBvcnQoKTsKICAgICAgICByZXR1cm4gbmV3SUQ7CiAgICB9CgogICAgcmVtb3ZlKGVsZW1lbnQpIHsKICAgICAgICB0aGlzLnN0b3JhZ2UuZGVsZXRlKGVsZW1lbnQuaWQpCiAgICAgICAgUHViU3ViLnB1Ymxpc2goInJlbW92ZSIsIGVsZW1lbnQuaWQpOwogICAgICAgIHRoaXMuZXhwb3J0KCk7CiAgICB9CgogICAgZm9yRWFjaChjYWxsYmFjaykgewogICAgICAgIHRoaXMuc3RvcmFnZS5mb3JFYWNoKGNhbGxiYWNrKTsKICAgIH0KCiAgICByZWZyZXNoRXh0ZXJpb3IobW91c2VYLCBtb3VzZVkpIHsKICAgICAgICB0aGlzLmZvckVhY2goKHBzKSA9PiB7CiAgICAgICAgICAgIHBzLnJlZnJlc2hFeHRlcmlvcihtb3VzZVgsIG1vdXNlWSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgcmVmcmVzaEF2YWlsYWJpbGl0eShkZXRlY3Rpb25zKSB7CiAgICAgICAgdGhpcy5mb3JFYWNoKChwcykgPT4gewogICAgICAgICAgICBsZXQgc3RhdGVDaGFuZ2VkID0gcHMucmVmcmVzaEF2YWlsYWJpbGl0eShkZXRlY3Rpb25zKTsKICAgICAgICAgICAgaWYgKHN0YXRlQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgUHViU3ViLnB1Ymxpc2goImNoYW5nZSIsIHtpZDogcHMuaWQsIGF2YWlsYWJsZTogcHMuYXZhaWxhYmxlfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICByZW5hbWUoaWQsIG5hbWUpIHsKICAgICAgICBsZXQgZWxlbWVudCA9IHRoaXMuc3RvcmFnZS5nZXQoaWQpCiAgICAgICAgZWxlbWVudC5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0KGlkLCBlbGVtZW50KQogICAgICAgIHRoaXMuZXhwb3J0KCk7CiAgICB9CgogICAgaGlnaGxpZ2h0KGlkKSB7CiAgICAgICAgdGhpcy5mb3JFYWNoKChwcykgPT4gewogICAgICAgICAgICBpZiAocHMuaWQgPT0gaWQpIHsKICAgICAgICAgICAgICAgIHBzLmhpZ2hsaWdodCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwcy5oaWdobGlnaHQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIGlzRHVwbGljYXRlKG5hbWUpIHsKICAgICAgICBsZXQgZHVwbGljYXRlID0gZmFsc2U7CiAgICAgICAgdGhpcy5mb3JFYWNoKChwcykgPT4gewogICAgICAgICAgICBpZiAocHMubmFtZSA9PSBuYW1lKSBkdXBsaWNhdGUgPSB0cnVlOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBkdXBsaWNhdGU7CiAgICB9CgogICAgZXhwb3J0KCkgewogICAgICAgIGxldCB0ZW1wU3RvcmFnZSA9IHt9OwogICAgICAgIHRoaXMuZm9yRWFjaCgocHMpID0+IHsKICAgICAgICAgICAgdGVtcFN0b3JhZ2VbcHMuaWRdID0ge3g6IHBzLngsIHk6IHBzLnksIG5hbWU6IHBzLm5hbWV9OwogICAgICAgIH0pOwogICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5wb3N0KHRoaXMuaG9zdCArICcvY2FtZXJhL2RldGVjdC9jaGVja3BvaW50cycsIHRlbXBTdG9yYWdlKQogICAgICAgICAgICAudGhlbigocmVzcCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3AuY29kZSAhPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiY2Fubm90IHBvc3QgcG9pbnQgZGF0YSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICAgICAgfSk7CiAgICB9Cn0KCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJja2Vja3BvaW50LWVkaXRvciIsCiAgICBkYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgLy/or4bliKvnu5PmnpznlLvluIPlj4rlhbbkuIrkuIvmlocKICAgICAgICAgICAgZGV0ZWN0Q2FudmFzOiBudWxsLAogICAgICAgICAgICBkZXRlY3RDdHg6IG51bGwsCiAgICAgICAgICAgIC8v6L2m5L2N77yI5qOA5p+l54K577yJ5YiX6KGoCiAgICAgICAgICAgIHBhcmtpbmdTcGFjZVN0b3JhZ2U6IG51bGwsCiAgICAgICAgICAgIC8vZGV0ZWN0aW9uID0gW1t4LCB5LCB3LCBoXSwgW3gsIHksIHcsIGhdLCAuLi5dCiAgICAgICAgICAgIGRldGVjdGlvbnM6IG51bGwsCiAgICAgICAgICAgIC8v6byg5qCH5L2N572uCiAgICAgICAgICAgIG1vdXNlWDogMCwKICAgICAgICAgICAgbW91c2VZOiAwLAogICAgICAgICAgICAvL+aYr+WQpuWcqOe8lui+keeKtuaAgQogICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsCiAgICAgICAgICAgIC8v57yW6L6R54q25oCB55u45YWzCiAgICAgICAgICAgIGVkaXRNb2RlOiAiaW1tZWRpYXRlIiwKICAgICAgICAgICAgaW1tZWRpYXRlOiB7CiAgICAgICAgICAgICAgICBJRDogIiIsCiAgICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250aW51YWxzOiB7CiAgICAgICAgICAgICAgICBuZXh0OiAiMDAxIiwKICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICB9LAogICAgICAgICAgICAvL+aYr+WQpui/mOWcqOWIneWni+WMlgogICAgICAgICAgICBwcmVwYXJpbmc6IHRydWUsCiAgICAgICAgICAgIGhvc3Q6IGNvbmZpZy5heGlvcy5iYXNlVVJMCiAgICAgICAgfTsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgcmVuYW1lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UuaXNEdXBsaWNhdGUodGhpcy5pbW1lZGlhdGUubmFtZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW1tZWRpYXRlLnN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pbW1lZGlhdGUuc3RhdGUgPSBudWxsOwogICAgICAgICAgICBQdWJTdWIucHVibGlzaCgicmVuYW1lIiwgewogICAgICAgICAgICAgICAgaWQ6IHRoaXMuaW1tZWRpYXRlLklELAogICAgICAgICAgICAgICAgbmFtZTogdGhpcy5pbW1lZGlhdGUubmFtZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjb250aW51YWxzTmV4dDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgZGlnaXQgPSB0aGlzLmNvbnRpbnVhbHMubmV4dC5sZW5ndGg7CiAgICAgICAgICAgIGxldCBuZXdOZXh0ID0gYCR7TnVtYmVyLnBhcnNlSW50KHRoaXMuY29udGludWFscy5uZXh0KSArIDF9YDsKICAgICAgICAgICAgd2hpbGUgKG5ld05leHQubGVuZ3RoIDwgZGlnaXQpIG5ld05leHQgPSBgMCR7bmV3TmV4dH1gOwogICAgICAgICAgICB0aGlzLmNvbnRpbnVhbHMubmV4dCA9IG5ld05leHQ7CiAgICAgICAgfSwKICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIC8v5Yib5bu65a+56K+G5Yir57uT5p6c55S75biD5Y+K5YW25LiK5LiL5paH55qE5byV55SoCiAgICAgICAgLy8gdGhpcy5kZXRlY3RDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0Q2FudmFzIik7CiAgICAgICAgLy8gdGhpcy5kZXRlY3RDYW52YXMud2lkdGggPSA3MjA7CiAgICAgICAgLy8gdGhpcy5kZXRlY3RDYW52YXMuaGVpZ2h0ID0gNDgwOwogICAgICAgIC8vIHRoaXMuZGV0ZWN0Q3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImRldGVjdENhbnZhcyIpLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgLy/liJ3lp4vljJbmo4Dmn6XngrnlgqjlrZgKICAgICAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UgPSBuZXcgUGFya2luZ1NwYWNlU3RvcmFnZSgKICAgICAgICAgICAgdGhpcy5kZXRlY3RDdHgsCiAgICAgICAgICAgIHRoaXMuaG9zdAogICAgICAgICk7CiAgICAgICAgLy/ojrflj5bmnI3liqHlmajnq6/nvJPlrZjnmoTmo4Dmn6Xngrnkv6Hmga8KICAgICAgICB0aGlzLiRjdXJsLmdldCgnL2NhbWVyYS9kZXRlY3QvY2hlY2twb2ludHMnKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5sb2FkKHJlcy5kYXRhKTsKICAgICAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLndhcm5pbmcoSlNPTi5zdHJpbmdpZnkocmVzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIC8vIC8v6I635Y+W6K+G5Yir5qGGCiAgICAgICAgLy8gIGF4aW9zCiAgICAgICAgLy8gICAgIC5nZXQoYCR7dGhpcy5ob3N0fS9jYW1lcmEvZGV0ZWN0L2JveGApCiAgICAgICAgLy8gICAgIC50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgLy8gICAgICAgICBpZiAocmVzcC5jb2RlID09IDIwMCkgewogICAgICAgIC8vICAgICAgICAgICAgIHRoaXMuZGV0ZWN0aW9ucyA9IHJlc3AuZGF0YTsKICAgICAgICAvLyAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gICAgICAgICAgICAgdGhpcy5kZXRlY3Rpb25zID0gW107CiAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5lcnJvcigiY2Fubm90IGZldGNoIGRldGVjdGlvbnMiKTsKICAgICAgICAvLyAgICAgICAgIH0KICAgICAgICAvLyAgICAgfSkKICAgICAgICAvLyAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUuZXJyb3IoYCR7ZXJyfWApOwogICAgICAgIC8vICAgICB9KTsKCiAgICAgICAgLy/lvZPlm77lg4/mupDlrr3luqbkuI3mmK8w77yI5Y2z5bey5Yqg6L295aW977yJ5pe25Y+W5raIIuWHhuWkh+S4rSLpga7nvakKICAgICAgICBsZXQgcHJlcGFyZUNoZWNrZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZGV0ZWN0U291cmNlIikud2lkdGggIT0gMCkgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwcmVwYXJlQ2hlY2tlcik7CiAgICAgICAgICAgICAgICB0aGlzLnByZXBhcmluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSwgNTApOwoKICAgICAgICAvL+avjzUw5q+r56eS5Yi35paw5LiA5qyh55S75biDCiAgICAgICAgbGV0IGxhc3RSZWZyZXNoVGltZXN0YW1wID0gMDsKICAgICAgICBsZXQgcmVmcmVzaENhbnZhcyA9ICh0aW1lKSA9PiB7CiAgICAgICAgICAgIGlmICh0aW1lIC0gbGFzdFJlZnJlc2hUaW1lc3RhbXAgPiA1MCkgewogICAgICAgICAgICAgICAgbGFzdFJlZnJlc2hUaW1lc3RhbXAgPSB0aW1lOwogICAgICAgICAgICAgICAgbGV0IHNvdXJjZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkZXRlY3RTb3VyY2UiKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXRlY3RDdHguZHJhd0ltYWdlKHNvdXJjZSwgMCwgMCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIC8qaWdub3JlIHdhcm5pbmcqLwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLnJlZnJlc2hFeHRlcmlvcih0aGlzLm1vdXNlWCwgdGhpcy5tb3VzZVkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZWZyZXNoQ2FudmFzKTsKICAgICAgICB9OwogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShyZWZyZXNoQ2FudmFzKTsKCiAgICAgICAgLy/mr48056eS6I635Y+W5LiA5qyh6K+G5Yir5qGG5bm25Yi35paw5Y2g55So5oOF5Ya1CiAgICAgICAgbGV0IGxhc3RGZXRjaFRpbWVzdGFtcCA9IDA7CiAgICAgICAgLy8gbGV0IGZldGNoRGV0ZWN0aW9uID0gYXN5bmMgKHRpbWUpID0+IHsKICAgICAgICAvLyAgICAgaWYgKHRpbWUgLSBsYXN0RmV0Y2hUaW1lc3RhbXAgPiA0MDAwKSB7CiAgICAgICAgLy8gICAgICAgICBsYXN0RmV0Y2hUaW1lc3RhbXAgPSB0aW1lOwogICAgICAgIC8vICAgICAgICAgYXdhaXQgYXhpb3MKICAgICAgICAvLyAgICAgICAgICAgICAuZ2V0KGAke3RoaXMuaG9zdH0vY2FtZXJhL2RldGVjdC9ib3hgKQogICAgICAgIC8vICAgICAgICAgICAgIC50aGVuKChyZXNwKSA9PiB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGlmIChyZXNwLmNvZGUgPT0gMjAwKSB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLmRldGVjdGlvbnMgPSByZXNwLmRhdGE7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLmRldGVjdGlvbnMgPSBbXTsKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoImNhbm5vdCBmZXRjaCBkZXRlY3Rpb25zIik7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIH0KICAgICAgICAvLyAgICAgICAgICAgICB9KQogICAgICAgIC8vICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAvLyAgICAgICAgICAgICB9KTsKICAgICAgICAvLyAgICAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5yZWZyZXNoQXZhaWxhYmlsaXR5KHRoaXMuZGV0ZWN0aW9ucyk7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZldGNoRGV0ZWN0aW9uKTsKICAgICAgICAvLyB9CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZldGNoRGV0ZWN0aW9uKTsKCiAgICAgICAgLy/lj5bmtojnlLvluIPngrnlh7vlj7PplK7ml7blvLnlh7rlj7PplK7oj5zljZUKICAgICAgICB0aGlzLmRldGVjdENhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0pOwoKICAgICAgICAvL+m8oOagh+aKrOi1t+aXtuWwneivleWIm+W7uuaWsOajgOafpeeCuQogICAgICAgIHRoaXMuZGV0ZWN0Q2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgaWYgKCF0aGlzLmVkaXRhYmxlKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLm1vdXNlWCA8IDcyMCAmJiB0aGlzLm1vdXNlWSA8IDQ4MCkgewogICAgICAgICAgICAgICAgbGV0IG5ld1BhcmtpbmdTcGFjZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09IDApIHsKICAgICAgICAgICAgICAgICAgICAvL+W3pumUruWNleWHu+aXtgogICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5rKh5pyJ5oKs5YGc5Zyo546w5pyJ5qOA5p+l54K55LiK77yM5YiZ5Yib5bu65LiA5Liq5paw55qE5qOA5p+l54K5CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmZvckVhY2goKHBzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcy5pc0hvdmVyKHRoaXMubW91c2VYLCB0aGlzLm1vdXNlWSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1BhcmtpbmdTcGFjZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1BhcmtpbmdTcGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lZGl0TW9kZSA9PSAiaW1tZWRpYXRlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbW1lZGlhdGUuSUQgPSB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UuY3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2VYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW91c2VZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWZzWyJpbW1lZGlhdGUtaW5wdXQiXS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVkaXRNb2RlID09ICJjb250aW51YWxzIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJraW5nU3BhY2VTdG9yYWdlLmNyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdXNlWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250aW51YWxzLm5leHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRpbnVhbHNOZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmJ1dHRvbiA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgLy/lj7PplK7ljZXlh7vml7YKICAgICAgICAgICAgICAgICAgICAvL+WmguaenOaCrOWBnOWcqOeOsOacieajgOafpeeCueS4iu+8jOWImeWIoOmZpOi/meS4quajgOafpeeCuQogICAgICAgICAgICAgICAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5mb3JFYWNoKChwcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHMuaXNIb3Zlcih0aGlzLm1vdXNlWCwgdGhpcy5tb3VzZVkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UucmVtb3ZlKHBzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5idXR0b24gPT0gMSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAoJHt0aGlzLm1vdXNlWH0sICR7dGhpcy5tb3VzZVl9KWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8v6byg5qCH56e75Yqo5pe25Yi35paw5YKo5a2Y55qE6byg5qCH5L2N572uCiAgICAgICAgdGhpcy5kZXRlY3RDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGlmICghdGhpcy5lZGl0YWJsZSkgcmV0dXJuOwogICAgICAgICAgICBsZXQgcmVjdCA9IHRoaXMuZGV0ZWN0Q2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICBsZXQgc2NhbGUgPSA3MjAgLyByZWN0LndpZHRoOwogICAgICAgICAgICB0aGlzLm1vdXNlWCA9IChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KSAqIHNjYWxlOwogICAgICAgICAgICB0aGlzLm1vdXNlWSA9IChldmVudC5jbGllbnRZIC0gcmVjdC50b3ApICogc2NhbGU7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuZGV0ZWN0Q2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsICgpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMuZWRpdE1vZGUgPT0gImltbWVkaWF0ZSIpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW1tZWRpYXRlLklEID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLmltbWVkaWF0ZS5uYW1lID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy/kuovku7blpITnkIYKICAgICAgICBQdWJTdWIuc3Vic2NyaWJlKCJyZW5hbWUiLCAobXNnLCBwYXlsb2FkKSA9PiB7CiAgICAgICAgICAgIHRoaXMucGFya2luZ1NwYWNlU3RvcmFnZS5yZW5hbWUocGF5bG9hZC5pZCwgcGF5bG9hZC5uYW1lKTsKICAgICAgICB9KTsKICAgICAgICBQdWJTdWIuc3Vic2NyaWJlKCJoaWdobGlnaHQiLCAobXNnLCBpZCkgPT4gewogICAgICAgICAgICB0aGlzLnBhcmtpbmdTcGFjZVN0b3JhZ2UuaGlnaGxpZ2h0KGlkKTsKICAgICAgICB9KTsKCiAgICAgICAgLyoqCiAgICAgICAgICogUHJvdmlkZXMgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGluIGEgY3Jvc3MgYnJvd3NlciB3YXkuCiAgICAgICAgICogaHR0cDovL3BhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy8KICAgICAgICAgKi8KICAgICAgICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHsKICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSkoKTsKICAgICAgICB9CiAgICB9LAogICAgd2F0Y2g6IHsKICAgICAgICBlZGl0YWJsZShuZXdWYWwpIHsKICAgICAgICAgICAgaWYgKG5ld1ZhbCkgUHViU3ViLnB1Ymxpc2goImVkaXQtc3RhcnQiKTsKICAgICAgICAgICAgZWxzZSBQdWJTdWIucHVibGlzaCgiZWRpdC1lbmQiKTsKICAgICAgICB9LAogICAgfSwKfTsK"},{"version":3,"sources":["CheckpointEditor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CheckpointEditor.vue","sourceRoot":"src/components/Configuration","sourcesContent":["<template>\r\n    <b-card fluid>\r\n        <template v-slot:header>\r\n            识别结果\r\n            <!--            <b-button class=\"float-right\" size=\"sm\" variant=\"outline-secondary\" v-b-modal.live>实时画面</b-button>-->\r\n            <b-modal id=\"live\" title=\"实时画面\" size=\"lg\" ok-only ok-title=\"返回\">\r\n                <b-img :src=\"host+'/camera/live'\" fluid-grow/>\r\n            </b-modal>\r\n        </template>\r\n        <!-- 基于mjpeg流的识别结果图像 -->\r\n        <img\r\n                :src=\"host+'/camera/detect_box?url=rtsp://192.168.137.102:8557&mode=car'\"\r\n                id=\"detectSource\"\r\n                crossorigin=\"Anonymous\"\r\n                width=\"584px\"\r\n                height=\"414px\"\r\n        />\r\n        <!-- UI设计时占位用的猫猫图 -->\r\n        <!--         <img src=\"../../assets/720x480.png\" id=\"detectSource\" style=\"display: none;\" />-->\r\n        <!-- 主画布 -->\r\n<!--                <b-overlay :show=\"preparing\">-->\r\n<!--                    <canvas id=\"detectCanvas\"></canvas>-->\r\n<!--                </b-overlay>-->\r\n        <!-- 编辑模式的控制表单 -->\r\n        <div v-if=\"editable\">\r\n            <!-- 编辑模式选择器 -->\r\n            <b-form-radio-group id=\"editModeSelector\" v-model=\"editMode\" class=\"mb-3\">\r\n                <b-form-radio value=\"immediate\">即时编号模式</b-form-radio>\r\n                <b-form-radio value=\"continuals\">连续编号模式</b-form-radio>\r\n            </b-form-radio-group>\r\n            <!-- 即时编号模式：每创建一个点，输入框就获得焦点 -->\r\n            <b-form inline v-if=\"editMode == 'immediate'\" class=\"mb-3\">\r\n                <label for=\"immediate-input\">输入编号</label>\r\n                <b-form-input\r\n                        id=\"immediate-input\"\r\n                        ref=\"immediate-input\"\r\n                        v-model=\"immediate.name\"\r\n                        :state=\"immediate.state\"\r\n                        @keyup=\"rename\"\r\n                />\r\n            </b-form>\r\n            <!-- 连续编号模式：输入初始值，按顺序递增 -->\r\n            <b-form inline v-if=\"editMode == 'continuals'\" class=\"mb-3\">\r\n                <label for=\"continuals-input\">下一个编号</label>\r\n                <b-form-input\r\n                        id=\"continuals-input\"\r\n                        v-model=\"continuals.next\"\r\n                        :state=\"continuals.state\"\r\n                />\r\n            </b-form>\r\n        </div>\r\n        <!-- 切换编辑模式的按钮 -->\r\n        <b-button\r\n                block\r\n                class=\"mt-3\"\r\n                variant=\"outline-secondary\"\r\n                @click=\"editable = !editable\"\r\n        >\r\n            {{ editable ? \"完成\" : \"编辑\" }}\r\n        </b-button>\r\n    </b-card>\r\n</template>\r\n\r\n<script>\r\n    import axios from \"axios\";\r\n    import {v4 as uuid} from \"uuid\";\r\n    import PubSub from \"pubsub-js\";\r\n    import config from \"@/config/config\";\r\n\r\n    class ParkingSpace {\r\n        constructor(x, y, id, name, ctx) {\r\n            this.x = x;\r\n            this.y = y;\r\n            this.id = id;\r\n            this.ctx = ctx;\r\n            this.name = name;\r\n            this.radius = 5;\r\n            this.available = true;\r\n            this.highlight = false;\r\n            this.availableCounter = 0;\r\n        }\r\n\r\n        isHover(mouseX, mouseY) {\r\n            // 水平距离或垂直距离大于半径，则一定不可能悬停\r\n            if (\r\n                Math.abs(this.x - mouseX) > this.radius ||\r\n                Math.abs(this.y - mouseY) > this.radius\r\n            ) {\r\n                return false;\r\n            }\r\n            let distance = Math.sqrt(\r\n                (this.x - mouseX) * (this.x - mouseX) +\r\n                (this.y - mouseY) * (this.y - mouseY)\r\n            );\r\n            if (distance > this.radius) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        refreshAvailability(detections) {\r\n            let available = true;\r\n            let stateChanged = false;\r\n            for (let e of detections) {\r\n                let left = e[0];\r\n                let top = e[1];\r\n                let right = left + e[2];\r\n                let bottom = top + e[3];\r\n                if (this.y > top && this.y < bottom && this.x > left && this.x < right) {\r\n                    available = false;\r\n                    break;\r\n                }\r\n            }\r\n            //模型容易把有车识别成没车，但不容易把没车识别成有车，所以连续识别三次没车才改变状态\r\n            if (available) {\r\n                this.availableCounter++;\r\n                if (this.availableCounter == 3) {\r\n                    this.available = true;\r\n                    this.availableCounter = 0;\r\n                    stateChanged = true;\r\n                }\r\n            } else {\r\n                if (this.available) stateChanged = true;\r\n                this.available = false;\r\n                this.availableCounter = 0;\r\n            }\r\n            return stateChanged;\r\n        }\r\n\r\n        refreshExterior(mouseX, mouseY) {\r\n            this.ctx.beginPath();\r\n            let isHover = this.isHover(mouseX, mouseY)\r\n            let resizeFactor = (this.highlight || isHover) ? 1.5 : 1\r\n            this.ctx.arc(this.x, this.y, this.radius * resizeFactor, 0, 2 * Math.PI, false);\r\n            this.ctx.fillStyle = (() => {\r\n                if (this.highlight) return \"#ffa500\";\r\n                if (this.available) return \"#00ff00\";\r\n                return \"#ff0000\";\r\n            })();\r\n            this.ctx.fill();\r\n            if (isHover) {\r\n                this.ctx.lineWidth = 2;\r\n                this.ctx.strokeStyle = this.available ? \"#003300\" : \"#330000\";\r\n                this.ctx.stroke();\r\n            }\r\n        }\r\n    }\r\n\r\n    class ParkingSpaceStorage {\r\n        constructor(ctx, host) {\r\n            this.ctx = ctx;\r\n            this.host = host;\r\n            this.storage = new Map();\r\n        }\r\n\r\n        load(data) {\r\n            for (let id in data) {\r\n                this.create(data[id].x, data[id].y, false, id, data[id].name);\r\n            }\r\n        }\r\n\r\n        create(x, y, exportNeeded, id = null, name = null) {\r\n            let newID = id == null ? uuid() : id;\r\n            let newName = name == null ? newID.substring(0, 5) : name;\r\n            this.storage.set(\r\n                newID,\r\n                new ParkingSpace(Math.round(x), Math.round(y), newID, newName, this.ctx)\r\n            );\r\n            PubSub.publish(\"create\", {\r\n                x: Math.round(x),\r\n                y: Math.round(y),\r\n                id: newID,\r\n                name: newName,\r\n            });\r\n            if (exportNeeded) this.export();\r\n            return newID;\r\n        }\r\n\r\n        remove(element) {\r\n            this.storage.delete(element.id)\r\n            PubSub.publish(\"remove\", element.id);\r\n            this.export();\r\n        }\r\n\r\n        forEach(callback) {\r\n            this.storage.forEach(callback);\r\n        }\r\n\r\n        refreshExterior(mouseX, mouseY) {\r\n            this.forEach((ps) => {\r\n                ps.refreshExterior(mouseX, mouseY);\r\n            });\r\n        }\r\n\r\n        refreshAvailability(detections) {\r\n            this.forEach((ps) => {\r\n                let stateChanged = ps.refreshAvailability(detections);\r\n                if (stateChanged) {\r\n                    PubSub.publish(\"change\", {id: ps.id, available: ps.available});\r\n                }\r\n            });\r\n        }\r\n\r\n        rename(id, name) {\r\n            let element = this.storage.get(id)\r\n            element.name = name;\r\n            this.storage.set(id, element)\r\n            this.export();\r\n        }\r\n\r\n        highlight(id) {\r\n            this.forEach((ps) => {\r\n                if (ps.id == id) {\r\n                    ps.highlight = true;\r\n                } else {\r\n                    ps.highlight = false;\r\n                }\r\n            });\r\n        }\r\n\r\n        isDuplicate(name) {\r\n            let duplicate = false;\r\n            this.forEach((ps) => {\r\n                if (ps.name == name) duplicate = true;\r\n            });\r\n            return duplicate;\r\n        }\r\n\r\n        export() {\r\n            let tempStorage = {};\r\n            this.forEach((ps) => {\r\n                tempStorage[ps.id] = {x: ps.x, y: ps.y, name: ps.name};\r\n            });\r\n            axios\r\n                .post(this.host + '/camera/detect/checkpoints', tempStorage)\r\n                .then((resp) => {\r\n                    if (resp.code !== 200) {\r\n                        console.error(\"cannot post point data\");\r\n                    }\r\n                })\r\n                .catch((err) => {\r\n                    console.log(err);\r\n                });\r\n        }\r\n    }\r\n\r\n    export default {\r\n        name: \"ckeckpoint-editor\",\r\n        data: function () {\r\n            return {\r\n                //识别结果画布及其上下文\r\n                detectCanvas: null,\r\n                detectCtx: null,\r\n                //车位（检查点）列表\r\n                parkingSpaceStorage: null,\r\n                //detection = [[x, y, w, h], [x, y, w, h], ...]\r\n                detections: null,\r\n                //鼠标位置\r\n                mouseX: 0,\r\n                mouseY: 0,\r\n                //是否在编辑状态\r\n                editable: false,\r\n                //编辑状态相关\r\n                editMode: \"immediate\",\r\n                immediate: {\r\n                    ID: \"\",\r\n                    name: \"\",\r\n                    state: null,\r\n                },\r\n                continuals: {\r\n                    next: \"001\",\r\n                    state: null,\r\n                },\r\n                //是否还在初始化\r\n                preparing: true,\r\n                host: config.axios.baseURL\r\n            };\r\n        },\r\n        methods: {\r\n            rename: function () {\r\n                if (this.parkingSpaceStorage.isDuplicate(this.immediate.name)) {\r\n                    this.immediate.state = false;\r\n                    return;\r\n                }\r\n                this.immediate.state = null;\r\n                PubSub.publish(\"rename\", {\r\n                    id: this.immediate.ID,\r\n                    name: this.immediate.name,\r\n                });\r\n            },\r\n            continualsNext: function () {\r\n                let digit = this.continuals.next.length;\r\n                let newNext = `${Number.parseInt(this.continuals.next) + 1}`;\r\n                while (newNext.length < digit) newNext = `0${newNext}`;\r\n                this.continuals.next = newNext;\r\n            },\r\n        },\r\n        created() {\r\n            //创建对识别结果画布及其上下文的引用\r\n            // this.detectCanvas = document.getElementById(\"detectCanvas\");\r\n            // this.detectCanvas.width = 720;\r\n            // this.detectCanvas.height = 480;\r\n            // this.detectCtx = document.getElementById(\"detectCanvas\").getContext(\"2d\");\r\n            //初始化检查点储存\r\n            this.parkingSpaceStorage = new ParkingSpaceStorage(\r\n                this.detectCtx,\r\n                this.host\r\n            );\r\n            //获取服务器端缓存的检查点信息\r\n            this.$curl.get('/camera/detect/checkpoints').then(res => {\r\n                    if (res.code === 200) {\r\n                        this.parkingSpaceStorage.load(res.data);\r\n                    } else{\r\n                        this.$Message.warning(JSON.stringify(res));\r\n                    }\r\n                });\r\n            // //获取识别框\r\n            //  axios\r\n            //     .get(`${this.host}/camera/detect/box`)\r\n            //     .then((resp) => {\r\n            //         if (resp.code == 200) {\r\n            //             this.detections = resp.data;\r\n            //         } else {\r\n            //             this.detections = [];\r\n            //             console.error(\"cannot fetch detections\");\r\n            //         }\r\n            //     })\r\n            //     .catch((err) => {\r\n            //         console.error(`${err}`);\r\n            //     });\r\n\r\n            //当图像源宽度不是0（即已加载好）时取消\"准备中\"遮罩\r\n            let prepareChecker = setInterval(() => {\r\n                if (document.getElementById(\"detectSource\").width != 0) {\r\n                    clearInterval(prepareChecker);\r\n                    this.preparing = false;\r\n                }\r\n            }, 50);\r\n\r\n            //每50毫秒刷新一次画布\r\n            let lastRefreshTimestamp = 0;\r\n            let refreshCanvas = (time) => {\r\n                if (time - lastRefreshTimestamp > 50) {\r\n                    lastRefreshTimestamp = time;\r\n                    let source = document.getElementById(\"detectSource\");\r\n                    try {\r\n                        this.detectCtx.drawImage(source, 0, 0);\r\n                    } catch (error) {\r\n                        /*ignore warning*/\r\n                    }\r\n                    this.parkingSpaceStorage.refreshExterior(this.mouseX, this.mouseY);\r\n                }\r\n                requestAnimationFrame(refreshCanvas);\r\n            };\r\n            requestAnimationFrame(refreshCanvas);\r\n\r\n            //每4秒获取一次识别框并刷新占用情况\r\n            let lastFetchTimestamp = 0;\r\n            // let fetchDetection = async (time) => {\r\n            //     if (time - lastFetchTimestamp > 4000) {\r\n            //         lastFetchTimestamp = time;\r\n            //         await axios\r\n            //             .get(`${this.host}/camera/detect/box`)\r\n            //             .then((resp) => {\r\n            //                 if (resp.code == 200) {\r\n            //                     this.detections = resp.data;\r\n            //                 } else {\r\n            //                     this.detections = [];\r\n            //                     console.error(\"cannot fetch detections\");\r\n            //                 }\r\n            //             })\r\n            //             .catch((err) => {\r\n            //                 console.error(err);\r\n            //             });\r\n            //         this.parkingSpaceStorage.refreshAvailability(this.detections);\r\n            //     }\r\n            //     requestAnimationFrame(fetchDetection);\r\n            // }\r\n            requestAnimationFrame(fetchDetection);\r\n\r\n            //取消画布点击右键时弹出右键菜单\r\n            this.detectCanvas.addEventListener(\"contextmenu\", (event) => {\r\n                event.preventDefault();\r\n            });\r\n\r\n            //鼠标抬起时尝试创建新检查点\r\n            this.detectCanvas.addEventListener(\"mouseup\", (event) => {\r\n                if (!this.editable) return;\r\n                if (this.mouseX < 720 && this.mouseY < 480) {\r\n                    let newParkingSpace = true;\r\n                    if (event.button == 0) {\r\n                        //左键单击时\r\n                        //如果没有悬停在现有检查点上，则创建一个新的检查点\r\n                        this.parkingSpaceStorage.forEach((ps) => {\r\n                            if (ps.isHover(this.mouseX, this.mouseY)) {\r\n                                newParkingSpace = false;\r\n                            }\r\n                        });\r\n                        if (newParkingSpace) {\r\n                            if (this.editMode == \"immediate\") {\r\n                                this.immediate.ID = this.parkingSpaceStorage.create(\r\n                                    this.mouseX,\r\n                                    this.mouseY,\r\n                                    true\r\n                                );\r\n                                this.$refs[\"immediate-input\"].focus();\r\n                            }\r\n                            if (this.editMode == \"continuals\") {\r\n                                this.parkingSpaceStorage.create(\r\n                                    this.mouseX,\r\n                                    this.mouseY,\r\n                                    true,\r\n                                    null,\r\n                                    this.continuals.next\r\n                                );\r\n                                this.continualsNext();\r\n                            }\r\n                        }\r\n                    } else if (event.button == 2) {\r\n                        //右键单击时\r\n                        //如果悬停在现有检查点上，则删除这个检查点\r\n                        this.parkingSpaceStorage.forEach((ps) => {\r\n                            if (ps.isHover(this.mouseX, this.mouseY)) {\r\n                                this.parkingSpaceStorage.remove(ps);\r\n                            }\r\n                        });\r\n                    } else if (event.button == 1) {\r\n                        console.log(`(${this.mouseX}, ${this.mouseY})`);\r\n                    }\r\n                }\r\n            });\r\n\r\n            //鼠标移动时刷新储存的鼠标位置\r\n            this.detectCanvas.addEventListener(\"mousemove\", (event) => {\r\n                if (!this.editable) return;\r\n                let rect = this.detectCanvas.getBoundingClientRect();\r\n                let scale = 720 / rect.width;\r\n                this.mouseX = (event.clientX - rect.left) * scale;\r\n                this.mouseY = (event.clientY - rect.top) * scale;\r\n            });\r\n\r\n            this.detectCanvas.addEventListener(\"mousedown\", () => {\r\n                if (this.editMode == \"immediate\") {\r\n                    this.immediate.ID = \"\";\r\n                    this.immediate.name = \"\";\r\n                }\r\n            });\r\n\r\n            //事件处理\r\n            PubSub.subscribe(\"rename\", (msg, payload) => {\r\n                this.parkingSpaceStorage.rename(payload.id, payload.name);\r\n            });\r\n            PubSub.subscribe(\"highlight\", (msg, id) => {\r\n                this.parkingSpaceStorage.highlight(id);\r\n            });\r\n\r\n            /**\r\n             * Provides requestAnimationFrame in a cross browser way.\r\n             * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n             */\r\n            if (!window.requestAnimationFrame) {\r\n                window.requestAnimationFrame = (function () {\r\n                    return (\r\n                        window.webkitRequestAnimationFrame ||\r\n                        window.mozRequestAnimationFrame ||\r\n                        window.oRequestAnimationFrame ||\r\n                        window.msRequestAnimationFrame ||\r\n                        function (callback) {\r\n                            window.setTimeout(callback, 1000 / 60);\r\n                        }\r\n                    );\r\n                })();\r\n            }\r\n        },\r\n        watch: {\r\n            editable(newVal) {\r\n                if (newVal) PubSub.publish(\"edit-start\");\r\n                else PubSub.publish(\"edit-end\");\r\n            },\r\n        },\r\n    };\r\n</script>\r\n\r\n<style scoped>\r\n    #detectCanvas {\r\n        width: 100%;\r\n    }\r\n\r\n</style>\r\n"]}]}